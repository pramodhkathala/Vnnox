<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>PeopleLink LED Video Wall Configuration Calculator - Quotation PDF</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
  <style>
    body { font-family: 'Inter', sans-serif; margin: 0; padding: 28px; background: #eef1f8; color: #1c2738; font-size: 14px; }
    .main-wrapper { max-width: 1180px; margin: auto; }
    h2 { text-align: center; color: #0D47A1; margin-top: 0; margin-bottom: 18px; font-weight: 700; font-size: 1.6em; }
    .input-panel { background: #ffffff; padding: 20px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.06); }
    .input-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px 18px; }
    label { display:block; margin-bottom:6px; font-weight:600; color:#444; }
    select,input { width:100%; padding:8px 10px; border-radius:6px; border:1px solid #ddd; font-size:14px; box-sizing:border-box; }
    .submit-btn{ background:#0D47A1;color:#fff;padding:10px 14px;border-radius:8px;border:none;cursor:pointer;font-weight:700;margin-top:8px; }
    .visualization{ margin-top:18px; background:#fff;padding:18px;border-radius:10px; box-shadow:0 4px 12px rgba(0,0,0,0.06); display:none; }
    .visualization.visible{ display:block; }
    .details-box{ margin-bottom:12px; background:#f7f9fc; padding:12px; border-radius:8px; }
    #boqPreviewTable{ width:100%; border-collapse:collapse; font-size:13px; }
    #boqPreviewTable th, #boqPreviewTable td{ border:1px solid #e6eef6; padding:8px; text-align:left; vertical-align:top;}
    #boqPreviewTable th{ background:#eef6ff; color:#0D47A1; font-weight:700; }
    footer{ text-align:center;margin-top:16px;color:#9fb1d7; }
    @media (max-width:900px){ .input-grid{grid-template-columns:1fr;} }
  </style>
</head>
<body>
  <div class="main-wrapper">
    <h2>LED Video Wall Configuration Calculator</h2>

    <div class="input-panel">
      <div style="display:flex;gap:12px;flex-wrap:wrap;">
        <div style="flex:1">
          <label for="productModel">LED Model / Pixel Pitch</label>
          <select id="productModel">
            <option value="">Select LED Model</option>
            <optgroup label="COB Models (16:9 Cabinet - 600x337.5mm)">
              <option value="cob_09">0.9375mm</option>
              <option value="cob_125">1.25mm</option>
              <option value="cob_15">1.5625mm</option>
            </optgroup>
            <optgroup label="SMD Indoor Models (4:3 Cabinet - 640x480mm)">
              <option value="indoor_186">1.86mm</option>
              <option value="indoor_20">2.0mm</option>
              <option value="indoor_25">2.5mm</option>
            </optgroup>
            <optgroup label="SMD Outdoor Models (1:1 Cabinet - 960x960mm)">
              <option value="outdoor_40">4.0mm</option>
              <option value="outdoor_667">6.67mm</option>
              <option value="outdoor_80">8.0mm</option>
              <option value="outdoor_100">10.0mm</option>
            </optgroup>
          </select>
        </div>

        <div style="flex:1">
          <label for="unit">Unit of Measurement</label>
          <select id="unit" onchange="toggleMeasurementFields()">
            <option value="">Select unit</option>
            <option value="meters">Meters (m)</option>
            <option value="feet">Feet (ft)</option>
            <option value="inches">Inches (in) - Diagonal</option>
          </select>
        </div>
      </div>

      <div style="display:flex;gap:12px;margin-top:12px;flex-wrap:wrap;">
        <div style="flex:1" id="widthGroup">
          <label id="widthLabel">Desired Width (m)</label>
          <input type="number" id="width" step="0.01" min="0.1" placeholder="Width">
        </div>
        <div style="flex:1" id="heightGroup">
          <label id="heightLabel">Desired Height (m)</label>
          <input type="number" id="height" step="0.01" min="0.1" placeholder="Height">
        </div>
      </div>

      <div style="margin-top:10px;">
        <div id="diagonalGroup" style="display:none;">
          <label id="diagonalLabel">Desired Diagonal (inches)</label>
          <input type="number" id="diagonal" step="1" min="10" placeholder="Diagonal (inches)">
        </div>
      </div>

      <div style="margin-top:10px; display:flex; gap:12px; align-items:center;">
        <div style="flex:1;">
          <label for="aspectRatio">Target Aspect Ratio (opt)</label>
          <select id="aspectRatio">
            <option value="">Auto</option>
            <option value="16:9">16:9</option>
            <option value="16:10">16:10</option>
            <option value="4:3">4:3</option>
            <option value="21:9">21:9</option>
            <option value="1:1">1:1</option>
          </select>
        </div>
        <div style="align-self:flex-end;">
          <button class="submit-btn" onclick="showVisualization()">Calculate & Visualize System</button>
        </div>
      </div>
    </div>

    <div id="visualization" class="visualization">
      <div class="details-box">
        <strong>Summary:</strong> <span id="summaryText">--</span>
      </div>

      <div id="boqPreviewContainer"></div>

      <div style="display:flex; justify-content:flex-end; gap:10px; margin-top:12px;">
        <button class="submit-btn" onclick="openContactModal()">Download PDF Technical Summary (Quotation)</button>
        <button class="submit-btn" style="background:#6c757d" onclick="hideVisualization()">Modify</button>
      </div>
    </div>

    <div id="controllerModal" style="display:none;"></div>

    <div id="contactModal" style="display:none;"></div>

  </div>

  <script>
    // Constants
    const MM_PER_METER = 1000;
    const MM_PER_INCH = 25.4;
    const MM_PER_FOOT = MM_PER_INCH * 12;
    const PIXELS_PER_PORT_DEFAULT = 650000;
    const GLOBAL_PORT_BUFFER_PCT = 0.05;
    const POWER_BUFFER = 1.15;
    const WEIGHT_BUFFER = 1.15;

    const LED_PRODUCTS = {
      'cob_09': { name: "PeopleLink COB (0.9375mm)", pitch_mm: 0.9375, cabW_mm: 600, cabH_mm: 337.5, cabPixW: 640, cabPixH: 360, modulesPerCab: 8, weight_kg: 4.6, maxPower_W_m2: 300 },
      'cob_125': { name: "PeopleLink COB (1.25mm)", pitch_mm: 1.25, cabW_mm: 600, cabH_mm: 337.5, cabPixW: 480, cabPixH: 270, modulesPerCab: 8, weight_kg: 4.6, maxPower_W_m2: 300 },
      'cob_15': { name: "PeopleLink COB (1.5625mm)", pitch_mm: 1.5625, cabW_mm: 600, cabH_mm: 337.5, cabPixW: 384, cabPixH: 216, modulesPerCab: 8, weight_kg: 4.6, maxPower_W_m2: 300 },
      'indoor_186': { name: "PeopleLink SMD Indoor (1.86mm)", pitch_mm: 1.86, cabW_mm: 640, cabH_mm: 480, cabPixW: 344, cabPixH: 258, modulesPerCab: 6, weight_kg: 6.24, maxPower_W_m2: 560 },
      'indoor_20': { name: "PeopleLink SMD Indoor (2.0mm)", pitch_mm: 2.0, cabW_mm: 640, cabH_mm: 480, cabPixW: 320, cabPixH: 240, modulesPerCab: 6, weight_kg: 6.24, maxPower_W_m2: 560 },
      'indoor_25': { name: "PeopleLink SMD Indoor (2.5mm)", pitch_mm: 2.5, cabW_mm: 640, cabH_mm: 480, cabPixW: 256, cabPixH: 192, modulesPerCab: 6, weight_kg: 6.24, maxPower_W_m2: 560 },
      'outdoor_40': { name: "PeopleLink SMD Outdoor (4.0mm)", pitch_mm: 4.0, cabW_mm: 960, cabH_mm: 960, cabPixW: 240, cabPixH: 240, modulesPerCab: 18, weight_kg: 8.28, maxPower_W_m2: 937.5 },
      'outdoor_667': { name: "PeopleLink SMD Outdoor (6.67mm)", pitch_mm: 6.67, cabW_mm: 960, cabH_mm: 960, cabPixW: 144, cabPixH: 144, modulesPerCab: 18, weight_kg: 8.28, maxPower_W_m2: 937.5 },
      'outdoor_80': { name: "PeopleLink SMD Outdoor (8.0mm)", pitch_mm: 8.0, cabW_mm: 960, cabH_mm: 960, cabPixW: 120, cabPixH: 120, modulesPerCab: 18, weight_kg: 8.28, maxPower_W_m2: 937.5 },
      'outdoor_100': { name: "PeopleLink SMD Outdoor (10.0mm)", pitch_mm: 10.0, cabW_mm: 960, cabH_mm: 960, cabPixW: 96, cabPixH: 96, modulesPerCab: 18, weight_kg: 8.28, maxPower_W_m2: 937.5 }
    };

    const CABINETS_PER_LONG_LAN = { 'cob_09': 2, 'cob_125': 5, 'cob_15': 7 };

    let finalCalculationData = {};

    function gcd(a,b){ return b===0 ? a : gcd(b, a%b); }

    function toggleMeasurementFields(){
      const unit = document.getElementById('unit').value;
      const isDiagonal = unit === 'inches';
      document.getElementById('widthGroup').style.display = isDiagonal ? 'none':'block';
      document.getElementById('heightGroup').style.display = isDiagonal ? 'none':'block';
      document.getElementById('diagonalGroup').style.display = isDiagonal ? 'block':'none';
      document.getElementById('width').value=''; document.getElementById('height').value=''; document.getElementById('diagonal').value='';
    }

    function calculateLEDWall(){
      const productKey = document.getElementById('productModel').value;
      const unit = document.getElementById('unit').value;
      const widthInput = parseFloat(document.getElementById('width').value || 0);
      const heightInput = parseFloat(document.getElementById('height').value || 0);
      const diagonalInput = parseFloat(document.getElementById('diagonal').value || 0);
      const aspectRatioKey = document.getElementById('aspectRatio').value;

      if(!productKey || !unit || ((unit!=='inches' && !widthInput && !heightInput) || (unit==='inches' && !diagonalInput))){
        alert('Please select model, unit and enter valid dimensions.');
        return null;
      }

      const details = LED_PRODUCTS[productKey];
      const cabW = details.cabW_mm, cabH = details.cabH_mm;

      let desiredW_mm=0, desiredH_mm=0;
      if(unit==='inches'){
        const ratio = aspectRatioKey || '16:9';
        const [rw,rh] = ratio.split(':').map(Number);
        const diagFactor = diagonalInput / Math.sqrt(rw*rw + rh*rh);
        desiredW_mm = rw * diagFactor * MM_PER_INCH;
        desiredH_mm = rh * diagFactor * MM_PER_INCH;
      } else {
        const factor = unit==='meters' ? MM_PER_METER : MM_PER_FOOT;
        if(aspectRatioKey){
          const [rw,rh] = aspectRatioKey.split(':').map(Number);
          if(widthInput>0){
            desiredW_mm = widthInput * factor;
            desiredH_mm = (widthInput / rw) * rh * factor;
          } else { // height provided
            desiredH_mm = heightInput * factor;
            desiredW_mm = (heightInput / rh) * rw * factor;
          }
        } else {
          desiredW_mm = (widthInput>0? widthInput: (heightInput*(cabW/cabH))) * factor;
          desiredH_mm = (heightInput>0? heightInput: (widthInput*(cabH/cabW))) * factor;
        }
      }

      let numCabW = Math.max(1, Math.round(desiredW_mm / cabW));
      let numCabH = Math.max(1, Math.round(desiredH_mm / cabH));
      const totalCabinets = numCabW * numCabH;
      const totalModules = totalCabinets * details.modulesPerCab;
      const finalW_mm = numCabW * cabW;
      const finalH_mm = numCabH * cabH;
      const finalArea_m2 = (finalW_mm/1000) * (finalH_mm/1000);
      const finalResW = numCabW * details.cabPixW;
      const finalResH = numCabH * details.cabPixH;
      const totalPixels = finalResW * finalResH;
      const ratioG = gcd(finalResW, finalResH);
      const aspectRatioText = `${finalResW/ratioG}:${finalResH/ratioG}`;
      const finalDiagonal_in = Math.sqrt(finalW_mm*finalW_mm + finalH_mm*finalH_mm) / MM_PER_INCH;

      // power/weight
      const actualPower_W = finalArea_m2 * details.maxPower_W_m2;
      const designPower_W = actualPower_W * POWER_BUFFER;
      const actualWeight = details.weight_kg * totalCabinets;
      const designWeight = actualWeight * WEIGHT_BUFFER;

      // ports
      const ports_by_pixels = Math.max(1, Math.ceil(totalPixels / PIXELS_PER_PORT_DEFAULT));
      const cabRule = CABINETS_PER_LONG_LAN[productKey];
      let ports_by_cabinets = 0;
      if(cabRule) ports_by_cabinets = Math.max(1, Math.ceil(totalCabinets / cabRule));
      else ports_by_cabinets = ports_by_pixels;
      let requiredPorts = Math.max(ports_by_pixels, ports_by_cabinets);
      const requiredPortsBuffered = Math.max(1, Math.ceil(requiredPorts * (1 + GLOBAL_PORT_BUFFER_PCT)));
      const requiredShortEthernet = Math.max(0, totalCabinets - requiredPortsBuffered);

      // store
      finalCalculationData = {
        productName: details.name,
        pixelPitch_mm: details.pitch_mm,
        cabinetW_mm: cabW,
        cabinetH_mm: cabH,
        cabPixW: details.cabPixW,
        cabPixH: details.cabPixH,
        numCabW, numCabH, totalCabinets, totalModules,
        finalW_mm, finalH_mm, finalArea_m2,
        finalResW, finalResH, totalPixels,
        aspectRatioText, finalDiagonal_in,
        actualPower_W, designPower_W, actualWeight, designWeight,
        requiredPortsBuffered, requiredShortEthernet
      };

      return finalCalculationData;
    }

    function showVisualization(){
      const data = calculateLEDWall();
      if(!data) return;
      document.getElementById('visualization').classList.add('visible');
      document.getElementById('summaryText').textContent = `${data.productName} — ${data.numCabW} x ${data.numCabH} (${data.totalCabinets} cabinets), Resolution ${data.finalResW} x ${data.finalResH}`;

      // render BOQ preview (combined col)
      const list = generateBOQList(data);
      let html = `<div style="padding:8px; background:#fff; border-radius:8px;"><h4 style="margin:0 0 8px 0;color:#0D47A1;">Bill of Quantities (Preview)</h4>
        <table id="boqPreviewTable"><thead><tr><th style="width:5%;">S.No</th><th style="width:55%;">Item / Description</th><th style="width:20%;">Partcode</th><th style="width:8%;text-align:right">Qty</th><th style="width:12%;">Unit</th></tr></thead><tbody>`;
      list.forEach((r,i)=>{
        html += `<tr><td>${i+1}</td><td class="small">${escapeHtml(r.combined)}</td><td>${escapeHtml(r.partcode)}</td><td style="text-align:right">${r.qty}</td><td>${r.unit}</td></tr>`;
      });
      // add two empty rows for unit price and total price (as requested)
      html += `<tr><td>${list.length+1}</td><td class="small"> </td><td> </td><td> </td><td> </td></tr>`;
      html += `<tr><td>${list.length+2}</td><td class="small">Grand Total (INR) — (To be filled)</td><td> </td><td> </td><td> </td></tr>`;
      html += `</tbody></table></div>`;
      document.getElementById('boqPreviewContainer').innerHTML = html;
    }

    // simple html escape
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

    // BOQ generator (combined column)
    function generateBOQList(data){
      const list = [];
      // Controller placeholder
      list.push({ combined: `Controller/Processor — Suggested per pixel count`, partcode: 'TBD', qty:1, unit:'PCS' });
      list.push({ combined: `Receiving Cards — (embedded)`, partcode: 'Embedded', qty: data.totalCabinets, unit:'PCS' });
      list.push({ combined: `Output (Sending) Cards — per controller`, partcode: 'TBD', qty: Math.max(1, Math.ceil(data.requiredPortsBuffered/20)), unit:'PCS' });
      list.push({ combined: `Input Cards — user configurable`, partcode: 'TBD', qty: 2, unit:'PCS' });
      list.push({ combined: `Modular Splicer Frame — (if modular H-series)`, partcode: 'TBD', qty: 1, unit:'PCS' });
      list.push({ combined: `Controller → Wall Long Ethernet Ports (post-buffer)`, partcode: 'TBD', qty: data.requiredPortsBuffered, unit:'PCS' });
      list.push({ combined: `Inter-cabinet Short Ethernet (CAT6)`, partcode: 'TBD', qty: data.requiredShortEthernet, unit:'PCS' });
      // LED Cabinets
      const ledKey = (data.pixelPitch_mm <= 1.0) ? 'PPL-COB-09' : (data.pixelPitch_mm <= 1.3) ? 'PPL-COB-125' : (data.cabinetW_mm===640 ? 'PPL-SMD-18' : 'PPL-SMD-40');
      list.push({ combined: `LED Cabinets (including modules) — ${data.productName}`, partcode: ledKey, qty: data.totalCabinets, unit:'PCS' });
      // Spare modules
      const sparePct = (data.pixelPitch_mm <= 1.3) ? 0.05 : 0.10;
      list.push({ combined: `Spare Modules (${Math.round(sparePct*100)}%) — site spares`, partcode:'TBD', qty: Math.max(1, Math.round(data.totalModules*sparePct)), unit:'PCS' });
      // power/installation
      list.push({ combined: `Estimated Design Power (W)`, partcode:'TBD', qty: Math.round(data.designPower_W), unit:'W' });
      list.push({ combined: `Installation & Configuration (Indoor)`, partcode:'ALED-INST-IN', qty: data.totalCabinets, unit:'Per Cabinet' });
      list.push({ combined: `Transportation (Indoor)`, partcode:'ALED-TRS-IN-REG', qty: data.totalCabinets, unit:'Per Cabinet' });
      list.push({ combined: `Power Supply (H_800W estimated)`, partcode:'TP-XPS-H800W', qty: Math.max(1, Math.ceil(data.totalCabinets/10)), unit:'PCS' });
      return list;
    }

    // ---------- PDF Generation (tight quotation layout) ----------
    function openContactModal(){
      if(!finalCalculationData || !finalCalculationData.totalPixels) {
        // try re-calc
        const d = calculateLEDWall();
        if(!d) { alert('Please calculate first'); return; }
      }
      proceedToDownloadPdf();
    }

    function proceedToDownloadPdf(){
      const data = finalCalculationData;
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF('p','mm','a4');
      const pageW = doc.internal.pageSize.getWidth();
      const margin = 10;
      let y = 10;

      // Header: Company + Quotation metadata
      doc.setFontSize(14);
      doc.setTextColor(13,71,161);
      doc.text('PEOPLELINK UNIFIED COMMUNICATIONS PVT. LTD.', margin, y);
      doc.setFontSize(9); doc.setTextColor(80,80,80);
      doc.text('Office: Hyderabad | Email: sales@peoplelink.in', margin, y+5);
      doc.setFontSize(12); doc.setTextColor(0,0,0);
      doc.text('QUOTATION / TECHNICAL SUMMARY', pageW/2, y, { align:'center' });
      y += 12;

      // Quote info box top-right
      const quoteNo = 'QTN-'+(new Date().getTime()).toString().slice(-6);
      doc.setFontSize(9);
      doc.text(`Quote No.: ${quoteNo}`, pageW - margin, y-8, { align:'right' });
      doc.text(`Date: ${new Date().toLocaleDateString()}`, pageW - margin, y-3, { align:'right' });
      doc.text(`Validity: 30 days`, pageW - margin, y+2, { align:'right' });
      y += 4;

      // Section: Wall performance & dims in two columns
      doc.setFontSize(10); doc.setTextColor(18,54,102);
      doc.text('1. Wall Performance & Dimensions', margin, y);
      y += 6;
      doc.setFontSize(8); doc.setTextColor(40,40,40);

      const leftX = margin;
      const rightX = pageW/2 + 4;
      let curY = y;

      doc.text('Final Dimensions (mm):', leftX, curY);
      doc.text(`${(data.finalW_mm).toLocaleString()} x ${(data.finalH_mm).toLocaleString()} mm`, leftX + 55, curY);
      doc.text('Final Dimensions (ft):', rightX, curY);
      doc.text(`${(data.finalW_mm/MM_PER_FOOT).toFixed(2)} x ${(data.finalH_mm/MM_PER_FOOT).toFixed(2)} ft`, rightX + 55, curY);
      curY += 5;

      doc.text('Final Diagonal:', leftX, curY);
      doc.text(`${data.finalDiagonal_in.toFixed(0)} inch`, leftX + 55, curY);
      doc.text('Final Area:', rightX, curY);
      doc.text(`${data.finalArea_m2.toFixed(2)} m² / ${(data.finalArea_m2*10.7639).toFixed(2)} ft²`, rightX + 55, curY);
      curY += 5;

      doc.text('Pixel Pitch:', leftX, curY);
      doc.text(`P ${data.pixelPitch_mm} mm`, leftX + 55, curY);
      doc.text('Aspect Ratio:', rightX, curY);
      doc.text(`${data.aspectRatioText}`, rightX + 55, curY);
      curY += 5;

      doc.text('Resolution (WxH):', leftX, curY);
      doc.text(`${data.finalResW} x ${data.finalResH} px`, leftX + 55, curY);
      doc.text('Total Pixels:', rightX, curY);
      doc.text(`${(data.totalPixels).toLocaleString()}`, rightX + 55, curY);
      curY += 5;

      // Pixel Density (pixels per m^2) - accurate calculation
      const pixelDensity = Math.round(data.totalPixels / Math.max(0.0001, data.finalArea_m2));
      doc.text('Pixel Density:', leftX, curY);
      doc.text(`${pixelDensity.toLocaleString()} pixels/m²`, leftX + 55, curY);
      doc.text('Required Sending Ports:', rightX, curY);
      doc.text(`${data.requiredPortsBuffered}`, rightX + 55, curY);
      curY += 7;

      y = curY + 2;

      // Section: BOQ title above table
      doc.setFontSize(10); doc.setTextColor(18,54,102);
      doc.text('2. Bill of Quantities', margin, y);
      y += 5;

      // Build BOQ rows with additional columns: S.No, Item/Description, Partcode, Qty, Unit, Unit Price, Total Price
      const boq = generateBOQList(data);
      // prepare rows
      const rows = boq.map((r, idx) => {
        return [
          String(idx+1),
          r.combined,
          r.partcode,
          String(r.qty),
          r.unit,
          '', // unit price blank
          ''  // total price blank
        ];
      });
      // add two requested empty rows (S.no included)
      rows.push([String(rows.length+1), '', '', '', '', '', '']);
      rows.push([String(rows.length+1), 'Grand Total (INR)', '', '', '', '', '']);

      // AutoTable the BOQ with fixed widths
      doc.autoTable({
        startY: y,
        head: [['S.No','Item / Description','Partcode','Qty','Unit','Unit Price','Total Price']],
        body: rows,
        margin: { left: margin, right: margin },
        theme: 'grid',
        headStyles: { fillColor: [13,71,161], textColor: 255, fontSize: 8 },
        styles: { fontSize: 8, cellPadding: 2.6 },
        columnStyles: {
          0: { cellWidth: 10, halign:'center' },
          1: { cellWidth: 80 },
          2: { cellWidth: 40 },
          3: { cellWidth: 18, halign:'right' },
          4: { cellWidth: 16, halign:'center' },
          5: { cellWidth: 24, halign:'right' },
          6: { cellWidth: 24, halign:'right' }
        },
        didDrawPage: function (dataArg) {
          // nothing extra
        }
      });

      y = doc.lastAutoTable.finalY + 6;

      // Section: Power / Weight and Connections (compact)
      doc.setFontSize(10); doc.setTextColor(18,54,102);
      doc.text('3. Power, Weight & Connections', margin, y);
      y += 5;
      doc.setFontSize(9); doc.setTextColor(40,40,40);
      doc.text(`Design Max Power (W): ${Math.round(data.designPower_W)} W`, margin, y);
      doc.text(`Design Wall Weight (kg): ${data.designWeight.toFixed(1)} kg`, pageW/2 + 10, y);
      y += 5;
      doc.text(`Controller Ports Required (post-buffer): ${data.requiredPortsBuffered}`, margin, y);
      doc.text(`Inter-cabinet short Ethernet runs: ${data.requiredShortEthernet}`, pageW/2 + 10, y);
      y += 8;

      // Terms & Conditions (short)
      doc.setFontSize(10); doc.setTextColor(18,54,102);
      doc.text('4. Standard Terms & Conditions', margin, y);
      y += 5;
      doc.setFontSize(8); doc.setTextColor(60,60,60);
      const terms = [
        "1) Price validity: 30 days.",
        "2) Payment terms: 50% advance, 40% on delivery, 10% on commissioning.",
        "3) Civil works, primary mounting & structural support to be provided by client unless included.",
        "4) Stable power & LAN drops near installation point must be provided by client.",
        "5) Warranty: 1 year on panels and accessories (manufacturing defects).",
        "6) Figures include 15% safety margin for design power/weight."
      ];
      terms.forEach(t=>{
        if(y > doc.internal.pageSize.getHeight() - 30){ doc.addPage(); y = margin; }
        doc.text(t, margin, y);
        y += 4.5;
      });

      // Footer
      doc.setFontSize(8); doc.setTextColor(130,130,130);
      doc.text('Prepared by: PeopleLink Unified Communications Pvt. Ltd. | Contact: sales@peoplelink.in', pageW/2, doc.internal.pageSize.getHeight()-8, { align:'center' });

      // Save file
      const filename = `PeopleLink_Quotation_${data.finalResW}x${data.finalResH}.pdf`;
      doc.save(filename);
    }

    // Init small UI helpers
    document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('unit').value='';
      document.getElementById('productModel').value='';
      // re-calc when user changes inputs (simple)
      ['productModel','unit','width','height','diagonal','aspectRatio'].forEach(id=>{
        const el = document.getElementById(id);
        if(el) el.addEventListener('change', ()=>{ try{ const d = calculateLEDWall(); if(d) { finalCalculationData = d; } }catch(e){} });
      });
    });
  </script>

  <footer>© 2025 PeopleLink Unified Communications Pvt. Ltd.</footer>
</body>
</html>
