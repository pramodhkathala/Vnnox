<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>PeopleLink LED Video Wall Calculator (Compact)</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<style>
  :root{--primary:#0D47A1;--accent:#B71C1C;--muted:#eef1f8}
  body{font-family:Inter,sans-serif;margin:0;padding:32px;background:var(--muted);color:#1c2738;font-size:14px}
  .wrap{max-width:1100px;margin:0 auto}
  h2{color:var(--primary);text-align:center;margin:0 0 18px}
  .panel{background:#fff;padding:20px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,.05)}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  label{font-weight:600;color:#444;margin-bottom:4px;display:block}
  select,input{width:100%;padding:8px;border:1px solid #ddd;border-radius:6px;font-size:14px}
  button.btn{background:var(--primary);color:#fff;padding:10px;border:0;border-radius:8px;cursor:pointer}
  button.gray{background:#6c757d}
  .hidden{display:none}
  .vis{margin-top:18px;opacity:0;max-height:0;overflow:hidden;transition:all .4s}
  .vis.visible{opacity:1;max-height:2000px}
  .details{display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-top:14px}
  .box{background:#f7f9fc;padding:12px;border-radius:8px;border:1px solid #e6e9ef}
  .small{font-size:13px;color:#666}
  .dim{position:relative;background:linear-gradient(135deg,#e3f2fd,#bbdefb);border:3px solid var(--accent);height:300px;display:flex;align-items:center;justify-content:center}
  #cabinetOverlay{position:absolute;inset:0;display:grid;pointer-events:none}
  .dim-label{position:absolute;background:rgba(255,255,255,.95);padding:4px 8px;border-radius:4px;font-weight:700;color:var(--accent)}
  .dim-top{top:8px;left:50%;transform:translateX(-50%)}.dim-right{right:8px;top:50%;transform:translateY(-50%) rotate(90deg)}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.4);display:none;align-items:center;justify-content:center}
  .modal .card{background:#fff;padding:18px;border-radius:10px;max-width:720px;width:94%}
  .err{background:#ffebee;border:2px solid #B71C1C;padding:10px;border-radius:8px;color:#B71C1C;font-weight:700;text-align:center;margin-bottom:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="panel" id="formPanel">
    <h2>LED Video Wall Configuration Calculator</h2>
    <div id="error" class="err hidden"></div>

    <div class="grid">
      <div>
        <label>LED Model / Pixel Pitch</label>
        <select id="productModel">
          <option value="">Select LED Model</option>
        </select>
      </div>
      <div>
        <label>Unit of Measurement</label>
        <select id="unit"><option value="">Select unit</option><option value="meters">Meters (m)</option><option value="feet">Feet (ft)</option><option value="inches">Inches (in) - Diagonal</option></select>
      </div>

      <div id="widthGroup">
        <label id="widthLabel">Desired Width (m)</label>
        <input id="width" type="number" min="0.01" step="0.01" />
      </div>
      <div id="heightGroup">
        <label id="heightLabel">Desired Height (m)</label>
        <input id="height" type="number" min="0.01" step="0.01" />
      </div>

      <div id="diagGroup" class="hidden">
        <label>Desired Diagonal (inches)</label>
        <input id="diagonal" type="number" min="10" step="1" />
      </div>

      <div>
        <label>Target Aspect Ratio (Optional)</label>
        <select id="aspectRatio"><option value="">Auto / None</option><option value="16:9">16:9</option><option value="4:3">4:3</option><option value="1:1">1:1</option><option value="21:9">21:9</option></select>
      </div>

      <div style="grid-column:1/-1">
        <button class="btn" id="calcBtn">Calculate & Visualize System</button>
      </div>
    </div>
  </div>

  <div id="visualization" class="vis">
    <div class="details">
      <div class="box">
        <strong>LED Wall Specifications</strong>
        <div id="specs" class="small" style="margin-top:8px">--</div>
      </div>
      <div class="box">
        <strong>Control System</strong>
        <div id="controls" class="small" style="margin-top:8px">--</div>
      </div>
    </div>

    <div class="box dim" style="position:relative;margin-top:12px">
      <div id="cabinetOverlay"></div>
      <div class="dim-label dim-top" id="visW">-- W --</div>
      <div class="dim-label dim-right" id="visH">-- H --</div>
    </div>

    <div style="display:flex;gap:12px;margin-top:12px;align-items:center">
      <button class="btn" id="downloadPdf">Download PDF Technical Summary</button>
      <button class="gray" id="editBtn">Modify Configuration</button>
    </div>
  </div>
</div>

<!-- Controller & Contact Modals (compact) -->
<div id="controllerModal" class="modal"><div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h3 style="margin:0;color:var(--primary)">Control System</h3>
    <button onclick="closeModal('controllerModal')">✕</button>
  </div>
  <div style="margin-top:12px" id="controllerBody"></div>
  <div style="margin-top:12px;text-align:right"><button class="btn" onclick="applyController()">Apply</button></div>
</div></div>

<div id="contactModal" class="modal"><div class="card">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h3 style="margin:0;color:#1B5E20">Enter Contact Details</h3>
    <button onclick="closeModal('contactModal')">✕</button>
  </div>
  <div style="margin-top:12px">
    <label>Email</label><input id="email" type="email" />
    <label style="margin-top:8px">Phone</label><input id="phone" type="tel" />
    <div id="contactErr" class="err hidden"></div>
  </div>
  <div style="margin-top:12px;text-align:right"><button class="btn" onclick="confirmDownload()">Download</button></div>
</div></div>

<script>
/* --- Compact constants/data --- */
const MM_M=1000, MM_IN=25.4, MM_FT=MM_IN*12, M_TO_FT=3.28084, PIXELS_PER_PORT=650000, POWER_BUFFER=1.15, WEIGHT_BUFFER=1.15;
const LED = {
 c09:{name:"PeopleLink COB 0.9375mm",pitch:0.9375,cW:600,cH:337.5,pW:640,pH:360,modules:8,wt:4.6,maxWm2:460},
 c125:{name:"PeopleLink COB 1.25mm",pitch:1.25,cW:600,cH:337.5,pW:480,pH:270,modules:8,wt:4.6,maxWm2:420},
 c15:{name:"PeopleLink COB 1.5625mm",pitch:1.5625,cW:600,cH:337.5,pW:384,pH:216,modules:8,wt:4.6,maxWm2:380},
 in186:{name:"Indoor 1.86mm",pitch:1.86,cW:640,cH:480,pW:344,pH:258,modules:6,wt:6.24,maxWm2:320},
 in20:{name:"Indoor 2.0mm",pitch:2.0,cW:640,cH:480,pW:320,pH:240,modules:6,wt:6.24,maxWm2:300},
 in25:{name:"Indoor 2.5mm",pitch:2.5,cW:640,cH:480,pW:256,pH:192,modules:6,wt:6.24,maxWm2:260},
 o40:{name:"Outdoor 4.0mm",pitch:4.0,cW:960,cH:960,pW:240,pH:240,modules:18,wt:8.28,maxWm2:1200},
 o667:{name:"Outdoor 6.67mm",pitch:6.67,cW:960,cH:960,pW:144,pH:144,modules:18,wt:8.28,maxWm2:1100},
 o80:{name:"Outdoor 8.0mm",pitch:8.0,cW:960,cH:960,pW:120,pH:120,modules:18,wt:8.28,maxWm2:1000},
 o100:{name:"Outdoor 10.0mm",pitch:10.0,cW:960,cH:960,pW:96,pH:96,modules:18,wt:8.28,maxWm2:900}
};
const CONTROLLERS = [
 {name:"TB40",type:"Player",ports:2,maxPx:1300000,maxW:10240,maxH:8192},
 {name:"TB60",type:"Player",ports:4,maxPx:2300000,maxW:4096,maxH:4096},
 {name:"VX400 Pro",type:"AIO",ports:4,maxPx:2600000,maxW:10240,maxH:8192},
 {name:"VX600 Pro",type:"AIO",ports:6,maxPx:3900000,maxW:10240,maxH:8192},
 {name:"VX1000 Pro",type:"AIO",ports:10,maxPx:6500000,maxW:10240,maxH:8192},
 {name:"4K Prime",type:"AIO",ports:16,maxPx:10400000,maxW:16384,maxH:8192},
 {name:"H2 (2U)",type:"Modular",ports:20,maxPx:26000000,maxW:16384,maxH:8192},
 {name:"H5 (5U)",type:"Modular",ports:20,maxPx:39000000,maxW:16384,maxH:8192}
];

/* --- small utilities --- */
const $=(id)=>document.getElementById(id);
const fmt=(n,d=1)=>Number(n).toLocaleString(undefined,{minimumFractionDigits:d,maximumFractionDigits:d});
const formatLarge=(n)=>n>=1e6?`${(n/1e6).toFixed(2)}M`:n>=1e3?`${(n/1e3).toFixed(1)}K`:n.toLocaleString();
const gcd=(a,b)=>b===0?a:gcd(b,a%b);

/* --- populate product list --- */
function fillProducts(){
  const sel=$('productModel'); sel.innerHTML='<option value="">Select LED Model</option>';
  Object.keys(LED).forEach(k=>{
    const o=document.createElement('option'); o.value=k; o.text=LED[k].name; sel.appendChild(o);
  });
}
fillProducts();

/* --- UI toggles --- */
$('unit').addEventListener('change',()=>{
  const u=$('unit').value, diag=u==='inches';
  $('widthGroup').classList.toggle('hidden',diag);
  $('heightGroup').classList.toggle('hidden',diag);
  $('diagGroup').classList.toggle('hidden',!diag);
  $('error').classList.add('hidden');
});

/* --- core calculation --- */
let finalData={}, contact={email:'',phone:''};

function suggestController(totalPixels,w,h){
  return CONTROLLERS.find(c=>c.maxPx>=totalPixels && c.maxW>=w && c.maxH>=h) || CONTROLLERS[CONTROLLERS.length-1];
}

function calc(){
  const pk=$('productModel').value, unit=$('unit').value;
  const wV=parseFloat($('width').value), hV=parseFloat($('height').value), dV=parseFloat($('diagonal').value);
  if(!pk||!unit||((unit!=='inches'&&(isNaN(wV)&&isNaN(hV)))||(unit==='inches'&&isNaN(dV)))){
    showErr('Please select Model, Unit and enter valid dimensions.');
    return null;
  }
  const det=LED[pk], cabW=det.cW, cabH=det.cH;
  let desiredW_mm,desiredH_mm,usedRatio;
  if(unit==='inches'){
    const ratio=$('aspectRatio').value||'16:9'; const [rw,rh]=ratio.split(':').map(Number);
    const diagRatio=Math.sqrt(rw*rw+rh*rh), factor=dV/diagRatio;
    desiredW_mm=rw*factor*MM_IN; desiredH_mm=rh*factor*MM_IN; usedRatio=ratio;
  } else {
    const factor = unit==='meters'?MM_M:MM_FT;
    if($('aspectRatio').value){
      const [rw,rh]=$('aspectRatio').value.split(':').map(Number);
      if(!isNaN(wV)) { desiredW_mm=wV*factor; desiredH_mm=(wV/rw)*rh*factor; }
      else { desiredH_mm=hV*factor; desiredW_mm=(hV/rh)*rw*factor; }
      usedRatio=$('aspectRatio').value;
    } else {
      desiredW_mm = (isNaN(wV)? (hV*(cabW/cabH)) : wV) * factor;
      desiredH_mm = (isNaN(hV)? (wV*(cabH/cabW)) : hV) * factor;
      usedRatio = `cab ${cabW}:${cabH}`;
    }
  }

  // align to integer cabinets (round)
  const numW = Math.max(1,Math.round(desiredW_mm/cabW));
  const numH = Math.max(1,Math.round(desiredH_mm/cabH));
  const totalC = numW * numH;
  const finalW_mm = numW * cabW, finalH_mm = numH * cabH;
  const area_m2 = (finalW_mm/MM_M)*(finalH_mm/MM_M);
  const finalResW = numW*det.pW, finalResH = numH*det.pH, totalPx = finalResW*finalResH;
  const diag_in = Math.sqrt(finalW_mm**2 + finalH_mm**2)/MM_IN;
  const ratioG = gcd(finalResW, finalResH), aspectText = `${finalResW/ratioG}:${finalResH/ratioG}`;
  const powerActual = area_m2 * det.maxWm2, powerMax = powerActual * POWER_BUFFER, current = powerActual/220;
  const weightActual = totalC * det.wt, weightMax = weightActual * WEIGHT_BUFFER;
  const suggested = suggestController(totalPx, finalResW, finalResH);
  const portsNeeded = Math.max(1, Math.ceil(totalPx/PIXELS_PER_PORT)), sendCards = Math.max(1, Math.ceil(portsNeeded/20));
  finalData = { product:det.name,pitch:det.pitch, numW,numH,totalC,finalW_mm,finalH_mm,area_m2,finalResW,finalResH,totalPx,diag_in,aspectText,powerActual,powerMax,current,weightActual,weightMax,suggested,portsNeeded,sendCards };
  return finalData;
}

function showErr(msg){$('error').textContent=msg;$('error').classList.remove('hidden');$('error').scrollIntoView({behavior:'smooth'});}

function render(){
  const d=calc(); if(!d) return;
  $('formPanel').classList.add('hidden');
  $('visualization').classList.add('visible');
  $('specs').innerHTML=`
    Pixel Pitch: ${d.pitch} mm<br>
    Final Size: ${(d.finalW_mm/MM_M).toFixed(2)}m x ${(d.finalH_mm/MM_M).toFixed(2)}m (${(d.finalW_mm/MM_FT).toFixed(2)}ft x ${(d.finalH_mm/MM_FT).toFixed(2)}ft)<br>
    Resolution: ${d.finalResW} x ${d.finalResH} (AR ${d.aspectText})<br>
    Cabinets: ${d.totalC} (${d.numW} x ${d.numH}) | Modules: ${d.totalC*LED[Object.keys(LED).find(k=>LED[k].name===d.product)].modules}<br>
    Pixels/Area: ${formatLarge(d.totalPx)} / ${d.area_m2.toFixed(2)} m²
  `;
  $('controls').innerHTML=`
    Suggested Controller: ${d.suggested.name} (${d.suggested.type})<br>
    Required Long Ports: ${d.portsNeeded} | Sending Cards: ${d.sendCards} x 20-port<br>
    Power (est): ${fmt(d.powerActual,0)} W (±${Math.round((POWER_BUFFER-1)*100)}%) | Weight: ${fmt(d.weightActual,1)} kg
  `;
  // visualization grid
  const overlay=$('cabinetOverlay'); overlay.innerHTML=''; overlay.style.gridTemplateColumns=`repeat(${d.numW},1fr)`; overlay.style.gridTemplateRows=`repeat(${d.numH},1fr)`; overlay.style.display='grid';
  for(let i=0;i<d.numW*d.numH;i++){const e=document.createElement('div');e.style.border='1px dashed rgba(13,71,161,.3)';overlay.appendChild(e);}
  $('visW').textContent=`${(d.finalW_mm/MM_M).toFixed(2)} m (W)`; $('visH').textContent=`${(d.finalH_mm/MM_M).toFixed(2)} m (H)`;
}

/* --- events --- */
$('calcBtn').addEventListener('click',()=>{ $('error').classList.add('hidden'); render(); });
$('editBtn').addEventListener('click',()=>{ $('formPanel').classList.remove('hidden'); $('visualization').classList.remove('visible'); });

/* --- PDF & contact flow (compact) --- */
$('downloadPdf').addEventListener('click',()=>{
  if(!finalData || !finalData.totalPx) { showErr('Please calculate first'); return; }
  $('contactModal').style.display='flex';
});

function closeModal(id){$(id).style.display='none';}
function confirmDownload(){
  const email=$('email').value.trim(), phone=$('phone').value.trim(), ce=$('contactErr');
  ce.classList.add('hidden');
  if(!email||!phone){ ce.textContent='Please enter email & phone'; ce.classList.remove('hidden'); return;}
  contact.email=email; contact.phone=phone; closeModal('contactModal'); genPdf();
}

function genPdf(){
  const data=finalData;
  const { jsPDF } = window.jspdf; const doc=new jsPDF('p','mm','a4'); const m=12; let y=12;
  doc.setFontSize(16); doc.setTextColor(13,71,161); doc.text('PeopleLink LED Technical Summary',105,y,{align:'center'}); y+=8;
  doc.setFontSize(9); doc.setTextColor(80,80,80); doc.text(`Model: ${data.product}  |  Contact: ${contact.email} ${contact.phone}`,105,y,{align:'center'}); y+=8;
  doc.setTextColor(183,28,28); doc.setFontSize(12); doc.text('1. Wall Performance & Dimensions',m,y); y+=6;
  const perf=[
    ['Final Size',`${(data.finalW_mm/MM_FT).toFixed(2)}ft x ${(data.finalH_mm/MM_FT).toFixed(2)}ft  / ${(data.finalW_mm/MM_M).toFixed(2)}m x ${(data.finalH_mm/MM_M).toFixed(2)}m`],
    ['Resolution',`${data.finalResW} x ${data.finalResH}`],
    ['Aspect Ratio',data.aspectText],
    ['Diagonal',`${data.diag_in.toFixed(1)} in`],
    ['Pixels / Area',`${formatLarge(data.totalPx)} / ${data.area_m2.toFixed(2)} m²`]
  ];
  doc.autoTable({startY:y+2,margin:{left:m,right:m},body:perf,styles:{fontSize:9,cellPadding:2}});
  y=doc.lastAutoTable.finalY+6;
  const specs=[['Pixel Pitch',`${data.pitch} mm`],['Cabinet WxH',`${LED[Object.keys(LED).find(k=>LED[k].name===data.product)].cW}mm x ${LED[Object.keys(LED).find(k=>LED[k].name===data.product)].cH}mm`],['Cabinets',`${data.totalC} (${data.numW}x${data.numH})`],['Power est',`${fmt(data.powerActual,0)} W (±15%)`]];
  doc.autoTable({startY:y,margin:{left:m,right:m},body:specs,styles:{fontSize:9,cellPadding:2}});
  doc.save('PeopleLink_LED_Summary.pdf');
}

/* expose close for modals */
window.closeModal=closeModal;

/* small helper to apply controller (placeholder) */
function applyController(){closeModal('controllerModal');}

/* init small default mapping for quick use */
(function setDefaults(){ $('unit').value='meters'; })();
</script>
</body>
</html>
